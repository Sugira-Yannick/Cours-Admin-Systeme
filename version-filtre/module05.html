<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module-Kit de Ma√Ætrise : STP (Spanning Tree Protocol)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true, theme:'default'});</script>
    <style>
        :root {
            --red-priority: #dc3545;
            --orange-priority: #fd7e14;
            --green-priority: #28a745;
            --blue-priority: #007bff;
            --purple-priority: #6f42c1;
            --light-bg: #ffffff;
            --lighter-bg: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #212529;
            --border-color: #dee2e6;
            --shadow-color: rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--lighter-bg);
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #6f42c1 0%, #007bff 100%);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px var(--shadow-color);
            color: white;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.95;
            color: white;
            text-align: center;
        }
        
        /* Navigation Menu */
        .nav-container {
            background-color: var(--blue-priority);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px var(--shadow-color);
        }
        
        .nav-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            list-style: none;
            justify-content: center;
        }
        
        .nav-item a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 20px;
            background-color: rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
            font-size: 0.9rem;
            white-space: nowrap;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .nav-item a:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        /* Cards */
        .card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid;
            box-shadow: 0 4px 6px var(--shadow-color);
            border: 1px solid var(--border-color);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid;
            padding-bottom: 10px;
        }
        
        .card-title i {
            margin-right: 15px;
            font-size: 1.8rem;
        }
        
        .toggle-btn {
            background-color: var(--blue-priority);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }
        
        .toggle-btn:hover {
            background-color: #0056b3;
        }
        
        .collapsible-content {
            display: block;
        }
        
        /* Priority Colors */
        .priority-red {
            border-left-color: var(--red-priority);
        }
        
        .priority-red .card-title {
            color: var(--red-priority);
            border-bottom-color: var(--red-priority);
        }
        
        .priority-orange {
            border-left-color: var(--orange-priority);
        }
        
        .priority-orange .card-title {
            color: var(--orange-priority);
            border-bottom-color: var(--orange-priority);
        }
        
        .priority-green {
            border-left-color: var(--green-priority);
        }
        
        .priority-green .card-title {
            color: var(--green-priority);
            border-bottom-color: var(--green-priority);
        }
        
        .priority-blue {
            border-left-color: var(--blue-priority);
        }
        
        .priority-blue .card-title {
            color: var(--blue-priority);
            border-bottom-color: var(--blue-priority);
        }
        
        .priority-purple {
            border-left-color: var(--purple-priority);
        }
        
        .priority-purple .card-title {
            color: var(--purple-priority);
            border-bottom-color: var(--purple-priority);
        }
        
        /* Content Styling */
        h2, h3, h4 {
            margin: 20px 0 15px 0;
            color: var(--text-color);
        }
        
        h2 {
            font-size: 1.8rem;
            color: var(--blue-priority);
        }
        
        h3 {
            font-size: 1.5rem;
            color: #0056b3;
        }
        
        h4 {
            font-size: 1.3rem;
            color: #e36209;
        }
        
        p {
            margin-bottom: 15px;
            color: #495057;
        }
        
        ul, ol {
            margin-left: 30px;
            margin-bottom: 20px;
        }
        
        li {
            margin-bottom: 8px;
            color: #495057;
        }
        
        /* Code Blocks */
        pre {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            border: 1px solid #e9ecef;
            border-left: 4px solid;
        }
        
        code {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.95rem;
            color: #d63384;
        }
        
        .code-cisco { 
            border-left-color: var(--blue-priority); 
            background-color: #e7f1ff;
        }
        
        .code-python { 
            border-left-color: var(--green-priority); 
            background-color: #e6f4ea;
        }
        
        .code-yaml { 
            border-left-color: var(--purple-priority); 
            background-color: #f3e8ff;
        }
        
        .code-text { 
            border-left-color: var(--orange-priority); 
            background-color: #fff3e6;
        }
        
        /* Inline code */
        .inline-code {
            background-color: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
            color: #d63384;
            border: 1px solid #e9ecef;
        }
        
        /* Highlighted sections */
        .law {
            background-color: rgba(220, 53, 69, 0.08);
            border-left: 4px solid var(--red-priority);
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .law::before {
            content: "! ";
            color: var(--red-priority);
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .trap {
            background-color: rgba(253, 126, 20, 0.08);
            border-left: 4px solid var(--orange-priority);
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .trap::before {
            content: "? ";
            color: var(--orange-priority);
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        /* Click to reveal sections */
        .click-reveal {
            background-color: rgba(0, 123, 255, 0.08);
            border-left: 4px solid var(--blue-priority);
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .reveal-btn {
            background-color: var(--blue-priority);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }
        
        .reveal-btn:hover {
            background-color: #0056b3;
        }
        
        .reveal-content {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        /* Mermaid diagrams */
        .mermaid-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            overflow: auto;
            border: 1px solid var(--border-color);
        }
        
        /* Micro-kit Grid */
        .microkit-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .microkit-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .microkit-item {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            border-top: 4px solid var(--blue-priority);
            box-shadow: 0 2px 4px var(--shadow-color);
            border: 1px solid var(--border-color);
        }
        
        .microkit-item h4 {
            display: flex;
            align-items: center;
            margin-top: 0;
            margin-bottom: 15px;
            color: var(--blue-priority);
        }
        
        .microkit-item h4 i {
            margin-right: 10px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 15px;
            }
            
            .nav-list {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-item a {
                width: 100%;
                text-align: center;
            }
            
            pre {
                padding: 10px;
                font-size: 0.85rem;
            }
        }
        
        /* Print styles */
        @media print {
            body {
                background-color: white;
                color: black;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
                break-inside: avoid;
            }
            
            .header {
                background: white !important;
                color: black !important;
                box-shadow: none;
                border: 2px solid var(--blue-priority);
            }
            
            .nav-container, .toggle-btn, .reveal-btn {
                display: none;
            }
            
            .collapsible-content, .reveal-content {
                display: block !important;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1><i class="fas fa-project-diagram"></i> Module-Kit de Ma√Ætrise : STP</h1>
        <p class="subtitle">Spanning Tree Protocol - Reconstruction P√©dagogique 200%</p>
    </div>

    <!-- Navigation Menu -->
    <nav class="nav-container">
        <ul class="nav-list">
            <li class="nav-item"><a href="#analogie"><i class="fas fa-brain"></i> Analogie Syst√©mique</a></li>
            <li class="nav-item"><a href="#modele-mental"><i class="fas fa-sitemap"></i> Mod√®le Mental</a></li>
            <li class="nav-item"><a href="#noyau-dur"><i class="fas fa-gavel"></i> Noyau Dur</a></li>
            <li class="nav-item"><a href="#securite"><i class="fas fa-shield-alt"></i> S√©curit√©</a></li>
            <li class="nav-item"><a href="#examen"><i class="fas fa-graduation-cap"></i> Examen CCNA</a></li>
            <li class="nav-item"><a href="#lab"><i class="fas fa-flask"></i> Lab & Automatisation</a></li>
            <li class="nav-item"><a href="#depannage"><i class="fas fa-wrench"></i> D√©pannage</a></li>
            <li class="nav-item"><a href="#connections"><i class="fas fa-network-wired"></i> Connections</a></li>
            <li class="nav-item"><a href="#validation"><i class="fas fa-check-double"></i> Validation</a></li>
            <li class="nav-item"><a href="#microkit"><i class="fas fa-compress-arrows-alt"></i> Micro-Kit</a></li>
        </ul>
    </nav>

    <div class="container">
        <!-- Analogy Section -->
        <section id="analogie">
            <div class="card priority-purple">
                <div class="card-title">
                    <div>
                        <i class="fas fa-brain"></i> üìç ANALOGIE SYST√âMIQUE
                    </div>
                    <button class="toggle-btn" onclick="toggleSection('analogie-content')">Cliquer pour voir/masquer</button>
                </div>
                
                <div id="analogie-content" class="collapsible-content">
                    <p>Format Texte Libre et application de styles et de couleurs texteul.</p>
                    
                    <p><strong>Th√®me_central:</strong> "Le Directeur de la Circulation R√©seau"</p>
                    <p><strong>M√©taphore:</strong> "Un syst√®me de gestion du trafic a√©rien (ATC) pour un a√©roport (votre r√©seau)."</p>
                    <p><strong>√âl√©ments_cl√©s:</strong></p>
                    <ul>
                        <li><strong>√âl√©ment_1:</strong> "L'A√©roport Principal (Pont Racine) est choisi comme r√©f√©rence unique pour tous les vols. C'est le point de convergence le plus 'important' ou le plus central."</li>
                        <li><strong>√âl√©ment_2:</strong> "Les Tours de Contr√¥le (Commutateurs) √©changent des messages radios (BPDU) pour se coordonner et √©viter les collisions."</li>
                        <li><strong>√âl√©ment_3:</strong> "Les Pistes Actives (Ports D√©sign√©s/Racine) sont les seules voies autoris√©es pour le d√©collage et l'atterrissage du trafic (donn√©es) vers/depuis l'a√©roport principal."</li>
                        <li><strong>√âl√©ment_4:</strong> "Les Pistes de Secours/Alternatives (Ports Alternatifs/Blocking) sont ferm√©es √† la circulation mais pr√™tes √† √™tre activ√©es en cas de probl√®me sur une piste active. Elles emp√™chent deux avions de s'engager en m√™me temps (boucle)."</li>
                        <li><strong>√âl√©ment_5:</strong> "Le Plan de Vol (Co√ªt du Chemin) est calcul√© pour chaque avion (trame) pour d√©terminer la route la plus courte/efficace vers l'a√©roport principal."</li>
                    </ul>
                    <p><strong>Risque_analogique:</strong> "Un pirate qui se fait passer pour un nouvel a√©roport principal (Pont Racine usurp√©) avec une fausse fr√©quence radio (BPDU forg√©s) et reroute tout le trafic vers son 'a√©roport' pour l'espionner ou le faire crash. Cela correspond √† une attaque par usurpation de pont racine (Root Guard/BPDU Guard)."</p>
                </div>
            </div>
        </section>

        <!-- Mental Model Section -->
        <section id="modele-mental">
            <div class="card priority-purple">
                <div class="card-title">
                    <div>
                        <i class="fas fa-sitemap"></i> üß† MOD√àLE MENTAL (Diagramme Flowchart)
                    </div>
                    <button class="toggle-btn" onclick="toggleSection('modele-content')">Cliquer pour voir/masquer</button>
                </div>
                
                <div id="modele-content" class="collapsible-content">
                    <div class="mermaid-container">
                        <div class="mermaid">
flowchart TD
    A[STP: √âviter les boucles L2] --> B1["√âtape 1: √âlire le<br>Pont Racine (Root)"]
    A --> B2["√âtape 2: D√©finir les<br>Ports Racine (RP)"]
    A --> B3["√âtape 3: √âlire les<br>Ports D√©sign√©s (DP)"]
    A --> B4["√âtape 4: Bloquer les autres<br>Ports Alternatifs (AP)"]

    B1 --> C1["Crit√®re: BID le plus bas<br>BID = Priorit√© + MAC"]
    B2 --> C2["Crit√®re: Co√ªt vers le Root<br>le plus faible (Path Cost)"]
    B3 --> C3["Crit√®re: Sur un segment lien,<br>le port avec le meilleur<br>chemin vers le Root"]
    B4 --> C4["Action: √âtat BLOCKING<br>Pas de trafic donn√©es"]

    C1 --> D["Topologie logique<br>sans boucle √©tablie"]
    C2 --> D
    C3 --> D
    C4 --> D

    D --> E{["Lien actif tombe ?"]}
    E -- Oui --> F["Recalcul STA (Topology Change)<br>AP devient DP/RP<br>Temps de convergence:<br>STP=30-50s, RSTP <1s"]
    E -- Non --> G["√âtat Stable<br>BPDU Hello toutes les 2s"]

    F --> D
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Core Principles Section -->
        <section id="noyau-dur">
            <div class="card priority-red">
                <div class="card-title">
                    <div>
                        <i class="fas fa-gavel"></i> ‚ö° NOYAU DUR (Les lois Immuables)
                    </div>
                    <button class="toggle-btn" onclick="toggleSection('noyau-content')">Cliquer pour voir/masquer</button>
                </div>
                
                <div id="noyau-content" class="collapsible-content">
                    <div class="law">
                        <strong>Loi #1 :</strong> STP est un protocole de couche 2, aveugle aux VLAN par d√©faut (802.1D). Preuve/Pourquoi : Une instance STP unique couvre tous les VLANs sauf si on utilise PVST+ (Cisco) qui cr√©e une instance par VLAN.
                    </div>
                    
                    <div class="law">
                        <strong>Loi #2 :</strong> La d√©cision STP est hi√©rarchique et s'arr√™te au premier crit√®re discriminant. Preuve/Pourquoi : L'ordre est 1) BID Root le plus bas, 2) Co√ªt de chemin racine le plus bas, 3) BID exp√©diteur le plus bas, 4) Priorit√© de port exp√©diteur la plus basse, 5) ID de port exp√©diteur le plus bas.
                    </div>
                    
                    <div class="law">
                        <strong>Loi #3 :</strong> Un port ne transmet du trafic utilisateur que s'il est √† l'√©tat FORWARDING. Preuve/Pourquoi : Les √©tats BLOCKING, LISTENING, LEARNING sont des √©tats transitoires ou bloquants. Seul FORWARDING apprend les MAC et forwarde les trames.
                    </div>
                    
                    <div class="law">
                        <strong>Loi #4 :</strong> Seul le Pont Racine g√©n√®re des BPDU "de r√©f√©rence". Les autres commutateurs les relayent. Preuve/Pourquoi : Dans les BPDU re√ßues, l'identit√© du Root Bridge ne change pas. C'est le fondement de l'algorithme.
                    </div>
                    
                    <div class="law">
                        <strong>Loi #5 :</strong> Le co√ªt de port est inversement proportionnel √† la bande passante. Preuve/Pourquoi : 10 Mbps = Co√ªt 100, 1 Gbps = Co√ªt 4, 10 Gbps = Co√ªt 2 (valeurs courtes IEEE). Plus le lien est rapide, plus son co√ªt est bas, plus il a de chances d'√™tre utilis√©.
                    </div>
                </div>
            </div>
        </section>

        <!-- Security Section -->
        <section id="securite">
            <div class="card priority-red">
                <div class="card-title">
                    <div>
                        <i class="fas fa-shield-alt"></i> üîê PROFONDEUR S√âCURIT√â & M√âTIER
                    </div>
                    <button class="toggle-btn" onclick="toggleSection('securite-content')">Cliquer pour voir/masquer</button>
                </div>
                
                <div id="securite-content" class="collapsible-content">
                    <h3>üö® RISQUE PRINCIPAL</h3>
                    
                    <p><strong>Risque Principal :</strong> Usurpation de Pont Racine & Boucles Non D√©tect√©es</p>
                    <p><strong>‚Üí Attaque Type :</strong> Attaque par BPDU forg√©es. Un pirate connecte un switch (ex: Kali Linux avec yersinia) et envoie des BPDU annon√ßant un BID avec priorit√© 0, devenant le Root Bridge. Le trafic peut √™tre redirig√© vers son port d'√©coute.</p>
                    <p><strong>‚Üí D√©tection :</strong> <span class="inline-code">[Commande show ou log √† monitorer]</span></p>
                    <pre class="code-text">show spanning-tree inconsistentports
show spanning-tree root
! V√©rifier des changements fr√©quents du Root Bridge</pre>
                    <p><strong>‚Üí Mitigation Imm√©diate :</strong> <span class="inline-code">[Suite de commandes correctrices]</span></p>
                    <pre class="code-cisco">! Sur TOUS les ports d'acc√®s (vers utilisateurs)
interface range gi0/1-24
 spanning-tree bpduguard enable
 spanning-tree portfast
! Sur TOUS les ports d√©sign√©s/racine (vers infra)
 spanning-tree guard root</pre>
                    <p><strong>‚Üí Int√©gration Entreprise :</strong> BPDU Guard et Root Guard sont des standards de s√©curit√© de base. PortFast est obligatoire sur tout port d'acc√®s. Playbook Ansible pour appliquer cette config sur tous les switches. SIEM : Alerte sur les logs %SPANTREE-2-ROOTGUARD_BLOCK ou %SPANTREE-2-BLOCK_BPDUGUARD.</p>
                    <pre class="code-yaml">- name: Harden STP on access ports
  ios_config:
    lines:
      - spanning-tree bpduguard enable
      - spanning-tree portfast
    parents: "interface {{ item }}"
  loop: "{{ access_interfaces }}"</pre>
                </div>
            </div>
        </section>

        <!-- Exam Section -->
        <section id="examen">
            <div class="card priority-orange">
                <div class="card-title">
                    <div>
                        <i class="fas fa-graduation-cap"></i> üìö PROFONDEUR EXAMEN CCNA
                    </div>
                    <button class="toggle-btn" onclick="toggleSection('examen-content')">Cliquer pour voir/masquer</button>
                </div>
                
                <div id="examen-content" class="collapsible-content">
                    <div class="trap">
                        <strong>D√©tail Oubli√© #1 :</strong> Le champ de priorit√© du Bridge ID fait 4 bits, mais Cisco l'incr√©mente par pas de 4096. La priorit√© r√©elle = Valeur de base (0-61440) + VLAN ID. Donc pour VLAN 10, priorit√© configur√©e 32768 = 32778 dans le BID.
                    </div>
                    
                    <div class="trap">
                        <strong>Pi√®ge Fr√©quent #2 :</strong> Beaucoup pensent que show spanning-tree suffit. Il faut toujours v√©rifier show spanning-tree vlan X dans un environnement multi-VLAN, car le Root peut √™tre diff√©rent par VLAN avec PVST+.
                    </div>
                    
                    <div class="trap">
                        <strong>Question Type :</strong> Q: Sur un switch, les commandes spanning-tree vlan 1 priority 0 et spanning-tree vlan 1 root primary sont-elles √©quivalentes ? R: Presque, mais pas tout √† fait. root primary fixe la priorit√© √† 24576 si la priorit√© actuelle du root est >= 24576, sinon elle la fixe √† 4096 de moins que le root actuel. priority 0 la fixe strictement √† 0.
                    </div>
                </div>
            </div>
        </section>

        <!-- Lab Section -->
        <section id="lab">
            <div class="card priority-blue">
                <div class="card-title">
                    <div>
                        <i class="fas fa-flask"></i> ‚öôÔ∏è LAB COMPLET : DE LA CONFIG √Ä L'AUTOMATISATION
                    </div>
                    <button class="toggle-btn" onclick="toggleSection('lab-content')">Cliquer pour voir/masquer</button>
                </div>
                
                <div id="lab-content" class="collapsible-content">
                    <h3>### Niveau 1 (CCNA) : Configuration Fondamentale</h3>
                    <pre class="code-cisco">`[commande 1]` ‚Üí *Objectif :* [...]
`[commande 2]` ‚Üí *V√©rification :* `[show command]` ‚Üí *Sortie attendue :* [...]</pre>
                    
                    <pre class="code-cisco">! 1. V√©rifier l'√©tat STP actuel
show spanning-tree
show spanning-tree vlan 1
show spanning-tree root
! Objectif : Identifier le Root Bridge, les ports bloqu√©s.

! 2. Forcer un switch √† √™tre le Root Bridge pour le VLAN 1
spanning-tree vlan 1 root primary
! V√©rification :
show spanning-tree vlan 1 | include Bridge
! Sortie attendue : "This bridge is the root"

! 3. Modifier le co√ªt d'un port pour influencer le chemin
interface GigabitEthernet0/1
 spanning-tree vlan 1 cost 10
! Justification : Rendre ce lien plus attractif (co√ªt bas) pour le VLAN 1.</pre>
                    
                    <h3>### Niveau 2 (Production S√©curis√©e) : Hardening</h3>
                    <pre class="code-cisco">`[commande 1 avec options s√©curit√©]` ‚Üí *Risque si omis :* [...]
`[commande 2]` ‚Üí *Justification best-practice :* [...]</pre>
                    
                    <pre class="code-cisco">! 1. Activer les protections de base sur TOUS les ports d'acc√®s
interface range GigabitEthernet0/1-48
 switchport mode access
 spanning-tree portfast edge
 spanning-tree bpduguard enable
! Risque si omis : Une boucle physique cr√©√©e par un utilisateur provoquerait une temp√™te de diffusion.

! 2. Activer Root Guard sur les ports uplink/trunk
interface range GigabitEthernet0/49-50
 switchport mode trunk
 spanning-tree guard root
! Justification : Emp√™che un switch downstream mal configur√© ou malveillant de devenir le root.

! 3. Changer la version de STP pour une convergence rapide (RSTP/PVST+ est la norme)
spanning-tree mode rapid-pvst
! V√©rification :
show spanning-tree summary | include Mode
! Sortie : "Switch is in rapid-pvst mode"</pre>
                    
                    <h3>### Niveau 3 (Expert/Automatisation) : Script & Scale</h3>
                    <pre class="code-cisco"># Extrait de script Python (Netmiko) ou playbook Ansible
[Code pertinent]
‚Üí Avantage : [Temps gagn√©, erreurs √©vit√©es].</pre>
                    
                    <pre class="code-python"># Script Python (Netmiko) pour auditer la configuration STP sur un parc de switches
from netmiko import ConnectHandler
import csv

devices = [{'ip': '192.168.1.10', 'device_type': 'cisco_ios', 'username': 'admin', 'password': 'secret'}]

def audit_stp(connection):
    output = connection.send_command('show spanning-tree summary')
    lines = output.splitlines()
    stp_mode = 'Unknown'
    for line in lines:
        if 'rapid-pvst' in line.lower():
            stp_mode = 'Rapid-PVST'
        elif 'pvst' in line.lower():
            stp_mode = 'PVST+'
        elif 'mst' in line.lower():
            stp_mode = 'MST'
    # V√©rifier BPDU Guard
    bpdu_check = connection.send_command('show run | inc bpduguard')
    bpdu_status = 'Enabled' if 'bpduguard' in bpdu_check else 'Disabled'
    return {'STP_Mode': stp_mode, 'BPDU_Guard': bpdu_status}

with open('stp_audit.csv', 'w', newline='') as csvfile:
    fieldnames = ['Device_IP', 'STP_Mode', 'BPDU_Guard']
    writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
    writer.writeheader()
    for device in devices:
        net_connect = ConnectHandler(**device)
        result = audit_stp(net_connect)
        result['Device_IP'] = device['ip']
        writer.writerow(result)
        net_connect.disconnect()
print("Audit termin√©. Voir 'stp_audit.csv'")</pre>
                    <p><strong>‚Üí Avantage :</strong> [Temps gagn√© sur l'audit de s√©curit√©, erreurs √©vit√©es, documentation automatis√©e.]</p>
                </div>
            </div>
        </section>

        <!-- Troubleshooting Section -->
        <section id="depannage">
            <div class="card priority-green">
                <div class="card-title">
                    <div>
                        <i class="fas fa-wrench"></i> üö® SC√âNARIO DE D√âPANNAGE AVANC√â
                    </div>
                    <button class="toggle-btn" onclick="toggleSection('depannage-content')">Cliquer pour voir/masquer</button>
                </div>
                
                <div id="depannage-content" class="collapsible-content">
                    <p><strong>Sympt√¥me Complexe :</strong> Les utilisateurs du VLAN 10 se plaignent de lenteurs intermittentes et de d√©connexions. Le monitoring montre une utilisation CPU √† 95% sur le switch d'acc√®s SW-ACC-01. Aucune alarme lien down.</p>
                    
                    <h3>Processus de Diagnostic (Arbre D√©cisionnel) (Format Texte Libre) :</h3>
                    
                    <p>1. V√©rifier les erreurs sur les interfaces : show interface gi0/1-48 | include errors|broadcast. Si broadcast est anormalement √©lev√© (ex: >100k/sec) ‚Üí Suspicion de temp√™te de diffusion.</p>
                    
                    <p>2. Identifier la source des broadcasts : show mac address-table count | include All. Si le nombre d'adresses MAC fluctue violemment ‚Üí Instabilit√© de table MAC, sympt√¥me de boucle.</p>
                    
                    <p>3. Examiner STP : show spanning-tree vlan 10 inconsistentports. Si des ports sont list√©s ‚Üí BPDU incoh√©rentes re√ßues.</p>
                    
                    <p>4. Localiser le port probl√©matique : show spanning-tree vlan 10 detail | include Gi0/|from|forward. Chercher un port qui est dans l'√©tat FORWARDING mais qui re√ßoit des BPDU (ce qui est anormal pour un port d√©sign√©/racine).</p>
                    
                    <p><strong>Root Cause Probable :</strong> Boucle de couche 2. Un utilisateur a connect√© un c√¢ble Ethernet entre deux ports d'un switch ou entre deux switches dans le m√™me VLAN, en bypassant les liens trunk manag√©s. Les protections STP (BPDU Guard) √©taient d√©sactiv√©es sur ces ports d'acc√®s.</p>
                    
                    <h3>Fix et Rollback :</h3>
                    
                    <pre class="code-cisco">! Fix
[Commandes]
! V√©rification du fix
[Commandes]
! Rollback au cas o√π
[Commandes de rollback]</pre>
                    
                    <pre class="code-cisco">! 1. IDENTIFICATION ET D√âSACTIVATION MANUELLE (CRISE)
! Trouver le port avec le plus de traffic broadcast
show interface gi0/23 counters | include broadcast
! Sortie:  input broadcast packets 123456789
! Couper le port suspect
interface GigabitEthernet0/23
 shutdown
 description LOOP_SUSPECT_DISABLED_$(date)

! 2. V√âRIFICATION QUE LA BOUCLE EST ROMPUE
! L'utilisation CPU doit redescendre rapidement
show processes cpu sorted | include CPU utilization
! Le traffic broadcast doit chuter
show interface gi0/1 counters | include broadcast

! 3. APPLIQUER LA CORRECTION PERMANENTE
interface GigabitEthernet0/23
! R√©activer apr√®s enqu√™te
 no shutdown
 spanning-tree portfast edge
 spanning-tree bpduguard enable
! Rollback au cas o√π (si le port est critique et ne peut √™tre d√©sactiv√©)
! interface GigabitEthernet0/23
!  no spanning-tree bpduguard enable
!  spanning-tree bpdufilter enable  (MOINS S√âCURIS√â - temporaire)</pre>
                </div>
            </div>
        </section>

        <!-- Connections Section -->
        <section id="connections">
            <div class="card priority-blue">
                <div class="card-title">
                    <div>
                        <i class="fas fa-network-wired"></i> üîó CONNECTIONS SYST√âMIQUES
                    </div>
                    <button class="toggle-btn" onclick="toggleSection('connections-content')">Cliquer pour voir/masquer</button>
                </div>
                
                <div id="connections-content" class="collapsible-content">
                    <p><strong>‚Üê Module Pr√©c√©dent (VLANs & Trunking) :</strong> STP utilise les VLAN IDs via l'Extended System ID. Une mauvaise configuration de trunk (ex: VLAN natif incorrect) ou de VLAN peut mener STP √† cr√©er une topologie sous-optimale ou √† bloquer le mauvais lien.</p>
                    
                    <p><strong>‚Üí Module Suivant (EtherChannel & FHRP) :</strong> STP voit un EtherChannel (LAG) comme un seul lien logique. C'est la m√©thode privil√©gi√©e pour fournir de la redondance sans que STP ne bloque un des liens physiques. Comprendre les co√ªts STP est crucial pour configurer des EtherChannels efficaces. Les protocoles FHRP comme HSRP/GLBP fonctionnent au-dessus de STP ; si STP bloque le chemin vers le routeur actif, la redondance L3 √©choue.</p>
                    
                    <p><strong>üîÑ √âcosyst√®me R√©el :</strong> Dans les r√©seaux d√©finis par logiciel (SDN), le contr√¥leur (ex: Cisco DNA Center) utilise souvent un protocole comme Fabric Path ou se base sur EVPN/VXLAN qui supprime le besoin de STP en utilisant un routage de couche 3 sous-jacent. STP reste toutefois critique dans la couche d'acc√®s traditionnelle (branch).</p>
                </div>
            </div>
        </section>

        <!-- Validation Section -->
        <section id="validation">
            <div class="card priority-purple">
                <div class="card-title">
                    <div>
                        <i class="fas fa-check-double"></i> ‚ùì VALIDATION PAR EXERCICE MENTAL
                    </div>
                    <button class="toggle-btn" onclick="toggleSection('validation-content')">Cliquer pour voir/masquer</button>
                </div>
                
                <div id="validation-content" class="collapsible-content">
                    <p><strong>Question de Concept :</strong> En utilisant l'analogie du contr√¥le a√©rien, expliquez ce qui se passe si la tour de contr√¥le principale (Root Bridge) tombe en panne. Qui prend le relais et comment les avions (trames) sont-ils inform√©s du nouveau plan ?</p>
                    
                    <p><strong>Question de Pi√®ge :</strong> Un switch a une priorit√© de 28672 pour le VLAN 100. Quel est le VLAN ID ? (Rappel : Priorit√© = Base + VLAN ID. 28672 - 28672 % 4096 = 28672. (28672 % 4096 = 0). Donc Base = 28672, VLAN ID = 0? Impossible. En fait, 28672 / 4096 = 7. La base est 7*4096=28672. Donc VLAN ID = 0. Cela signifie que la priorit√© a √©t√© configur√©e sans consid√©rer le VLAN, ou qu'il s'agit du VLAN 1 (car 28672+1=28673). C'est un pi√®ge !)</p>
                    
                    <p><strong>Question de Crise :</strong> "Il est 3h du matin, tous les voyants des switches clignotent fr√©n√©tiquement, le monitoring crie √† la temp√™te de broadcast sur le VLAN de gestion. Quelle est votre premi√®re commande, votre premi√®re hypoth√®se, et votre plan d'action en 3 √©tapes ?"</p>
                    <p><strong>‚Üí 1√®re commande :</strong> show logging | include %SPANTREE|%BPDUGUARD (chercher l'origine dans les logs).</p>
                    <p><strong>‚Üí 1√®re hypoth√®se :</strong> Boucle L2 sur le VLAN de gestion due √† une erreur de cablage ou un √©quipement d√©fectueux.</p>
                    <p><strong>‚Üí Plan en 3 √©tapes :</strong> 1) Identifier et shutdown le segment fautif via les logs/CPU/broadcast. 2) Isoler le VLAN de gestion en coupant les trunks non essentiels temporairement. 3) Une fois stable, auditer et appliquer BPDU Guard / Root Guard sur tous les ports.</p>
                </div>
            </div>
        </section>

        <!-- Micro-Kit Section -->
        <section id="microkit">
            <div class="card priority-green">
                <div class="card-title">
                    <div>
                        <i class="fas fa-compress-arrows-alt"></i> üß© MICRO-KIT ESSENTIEL (SYNTH√àSE 1 PAGE A4)
                    </div>
                    <button class="toggle-btn" onclick="toggleSection('microkit-content')">Cliquer pour voir/masquer</button>
                </div>
                
                <div id="microkit-content" class="collapsible-content">
                    <p>√Ä la fin du Module-Kit de Ma√Ætrise, g√©n√©rez un Micro-Kit Ultra-Synth√©tique tenant sur une seule page A4, contenant :</p>
                    
                    <div class="microkit-grid">
                        <div class="microkit-item">
                            <h4><i class="fas fa-gavel"></i> üîπ Les 5 Lois Immuables (version courte)</h4>
                            <ol>
                                <li><strong>STP bloque</strong> pour √©viter les boucles.</li>
                                <li><strong>Le Root est √©lu</strong> au BID le plus bas.</li>
                                <li>Chaque switch non-root a <strong>un seul Port Racine</strong>.</li>
                                <li>Sur un segment, <strong>un seul Port D√©sign√©</strong>.</li>
                                <li><strong>RSTP (rapid-pvst)</strong> est la norme en production.</li>
                            </ol>
                        </div>
                        
                        <div class="microkit-item">
                            <h4><i class="fas fa-sitemap"></i> üîπ Un mini-mod√®le mental simplifi√© (diagramme flowchart TD)</h4>
                            <div class="mermaid">
flowchart TD
    S[Start: STP Goal] --> R[√âlire Root Bridge<br>Lowest BID Wins]
    R --> PR[Choisir Ports Racine<br>Lowest Path Cost to Root]
    PR --> DP[Choisir Ports D√©sign√©s<br>Best Path per Segment]
    DP --> B[Bloquer tous les autres<br>Ports Alternatifs]
    B --> L{Lien actif Down?}
    L -- Yes --> R
    L -- No --> S
                            </div>
                        </div>
                        
                        <div class="microkit-item">
                            <h4><i class="fas fa-terminal"></i> üîπ Les 6 commandes CLI incontournables du module</h4>
                            <ol>
                                <li><code>show spanning-tree vlan X</code></li>
                                <li><code>show spanning-tree root</code></li>
                                <li><code>show spanning-tree inconsistentports</code></li>
                                <li><code>spanning-tree vlan X root primary</code></li>
                                <li><code>spanning-tree bpduguard enable</code></li>
                                <li><code>spanning-tree mode rapid-pvst</code></li>
                            </ol>
                        </div>
                        
                        <div class="microkit-item">
                            <h4><i class="fas fa-exclamation-triangle"></i> üîπ Les 3 pi√®ges CCNA les plus fr√©quents</h4>
                            <ol>
                                <li>Priorit√© par d√©faut = 32768, mais <strong>BID = 32768 + VLAN ID</strong>.</li>
                                <li><strong>PortFast sans BPDU Guard</strong> est dangereux.</li>
                                <li>Co√ªt 1G = <strong>4</strong> (valeur courte), pas 19 ou 1000.</li>
                            </ol>
                        </div>
                        
                        <div class="microkit-item">
                            <h4><i class="fas fa-wrench"></i> üîπ Un sc√©nario de d√©pannage r√©sum√© en 3 √©tapes</h4>
                            <ol>
                                <li><strong>Sympt√¥me :</strong> CPU √©lev√©, broadcast storm. <strong>Action :</strong> <code>show interface | i broadcast</code> ‚Üí trouver le port.</li>
                                <li><strong>Diagnostic :</strong> Boucle L2. <strong>Action :</strong> <code>shutdown</code> le port fautif.</li>
                                <li><strong>Solution :</strong> <code>spanning-tree bpduguard enable</code> sur tous les ports d'acc√®s.</li>
                            </ol>
                        </div>
                        
                        <div class="microkit-item">
                            <h4><i class="fas fa-project-diagram"></i> üîπ Un mini-sch√©ma Un diagramme flowchart TD ultra-intuitif</h4>
                            <div class="mermaid">
flowchart TD
    A[Topologie avec<br>redondance L2] --> B{STP Activ√©?}
    B -->|Oui| C[üö¶ Ports Bloqu√©s<br>√âvite les boucles]
    C --> D[‚úì R√©seau Stable]
    B -->|Non| E[üîÑ Boucle L2 cr√©√©e]
    E --> F[üå™Ô∏è Temp√™te Broadcast]
    F --> G[üí• Panne R√©seau]
                            </div>
                        </div>
                        
                        <div class="microkit-item">
                            <h4><i class="fas fa-shield-alt"></i> üîπ 1 risque s√©curit√© + la mitigation la plus cruciale</h4>
                            <p><strong>Risque :</strong> Usurpation de Root Bridge via BPDU forg√©es.</p>
                            <p><strong>Mitigation :</strong> <code>spanning-tree bpduguard enable</code> sur <strong>TOUS</strong> les ports d'acc√®s (<code>switchport mode access</code>).</p>
                        </div>
                        
                        <div class="microkit-item">
                            <h4><i class="fas fa-calculator"></i> üîπ 1 √©quation mentale (ex: "STP = Priorit√© + MAC ‚Üí Root")</h4>
                            <p style="background-color: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; border: 1px solid #e9ecef;">
                                <strong>STP Decision =</strong><br>
                                Lowest [Root BID] ‚Üí<br>
                                Lowest [Path Cost] ‚Üí<br>
                                Lowest [Sender BID] ‚Üí<br>
                                Lowest [Sender Port ID]
                            </p>
                        </div>
                    </div>
                    
                    
                </div>
            </div>
        </section>
    </div>
	 <div style="text-align: center; margin-top: 50px; padding-top: 20px; border-top: 1px solid var(--light-border); color: #6c757d; font-size: 0.9rem;">
        <p>Module-Kit de Ma√Ætrise - Concepts du STP</p>
        <p>¬© 2025</p>
    </div>

    <script>
        // Toggle section content
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section.style.display === 'none') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }

        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // Initialize all sections as visible
        document.addEventListener('DOMContentLoaded', function() {
            const sections = document.querySelectorAll('.collapsible-content');
            sections.forEach(section => {
                section.style.display = 'block';
            });
        });
    </script>
</body>
</html>